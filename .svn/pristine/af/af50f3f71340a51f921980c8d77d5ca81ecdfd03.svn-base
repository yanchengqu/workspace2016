!function(){function t(t){var e=t.toString();if(/^\d+$/.test(e)){var n=new Date(parseInt(t));if(n)return n.format("yyyy-MM-dd hh:mm:ss")}return t}function e(){var t={productId:s,pageId:++d,type:p};$(".viewMore").hide(),$(".viewMoreloading").show(),$.ajax({url:c.commentList.url,type:c.commentList.type,data:t,success:function(t){t=t instanceof Object?t:JSON.parse(t),t&&t.success&&t.data&&(window.commentData=t.data,o("commentScriptTemplate",m.commentList),$(".viewMoreloading").hide(),window.commentData.length>=l&&$(".viewMore").show())},error:function(){}})}function n(t,e,n,o){var i={commentsId:t,replyContent:e};$.ajax({url:c.applyComment.url,type:c.applyComment.type,data:i,success:function(t){t=t instanceof Object?t:JSON.parse(t),t.success?n&&n(t):alert("评论失败！")},error:function(t){o&&o(t)}})}function o(t,e){var n=$("#"+t).html(),o=_.template(n),i=$("<div></div>").html(o);e.append(i.html())}function i(){$("#replyContentBox").val(""),$(".doCommentContainer").toggleClass("active"),$(".doCommentContainer textarea").value="",w=$("body").scrollTop(),setTimeout(function(){$(".commentSlider").hide()},400)}function r(){$(".commentSlider").show(),window.closeComment=!0,setTimeout(function(){$(".doCommentContainer").toggleClass("active"),w&&$("body").scrollTop(w)},0)}Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t};var a="ontouchstart"in window?"touchend":"click",m={moreBtn:$(".viewMore"),viewMoreloading:$(".viewMoreloading"),productIdHidden:$("#productIdEl"),commentList:$(".comment-list"),cancelBtn:$("#cancelBtn"),replayBtn:$("#replayBtn")},c={commentList:{url:"/mobile/comment_json/comment.html",type:"get"},applyComment:{url:"/mobile/comment_json/save.html",type:"get"}},s=m.productIdHidden.val(),l=10,d=1,p=$(".comment-count .piece:first-child").attr("data-type");m.moreBtn.on(a,function(){e()});var u="http://static.tongshuai.com/r/build/ts_h5/v1/img/pages/detail/headerPic.jpg";window.imgUrl=u,window.updateTime=t,$(document).on(a,".reply",function(t){if(window.isToLogin){var e=window.isToLogin();if(!e)return}var n=$(t.target).closest("li"),o=n.attr("data-value");o&&(window.currentCommentId=o,window.currentCommentLi=n,i())}),m.cancelBtn.on(a,function(){r()}),m.replayBtn.on(a,function(){var t=window.currentCommentId,e=$("#replyContentBox").val();return e=e.replace(/(^\s*)|(\s*$)/g,""),""===e?void layer.open({content:"回复内容不能为空",shadeClose:!1,btn:["好的"]}):void n(t,e,function(t){if(window.currentCommentLi){var e=$(".reply-box",window.currentCommentLi);if(e.length){window.rptitem=t.data,window.rptitem.showBox=!1;var n=$("div.reply-box>p>span",window.currentCommentLi),i=$("ol.box",window.currentCommentLi);if(n&&i){var a=parseInt(n.html());n.html(++a),o("commentRepeateTemplate",i)}}else window.rptitem=t.data,window.rptitem.showBox=!0,o("commentRepeateTemplate",window.currentCommentLi);r()}})});var w=0;$(".comment-count .piece").on(a,function(){$(this).addClass("active").siblings(".piece").removeClass("active");var t=$(this).attr("data-type");t!==p&&($(".comment-list>li").remove(),p=t,d=0,e())})}();